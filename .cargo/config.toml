# ============================================
# Build Time Optimization (RFC 0032)
# ============================================
# Inspired by Bevy's config_fast_builds.toml
# See: https://github.com/bevyengine/bevy/blob/main/.cargo/config_fast_builds.toml
#
# Use rust-lld for faster linking on all platforms
# Rust 1.93+ includes rust-lld by default
# Benefits: ~10-13s faster linking on Windows MSVC

# Windows MSVC - Use lld linker for faster builds
# Also statically link the C runtime for standalone executables
# See: https://github.com/astral-sh/ruff/issues/11503
[target.'cfg(all(target_env = "msvc", target_os = "windows"))']
rustflags = [
    "-C", "target-feature=+crt-static",
    "-C", "link-arg=-fuse-ld=lld",
]

# Linux gnu - Use lld linker for faster builds
# Alternative: Use mold for even faster linking (install: sudo apt install mold)
# To use mold, replace lld with mold below:
# rustflags = ["-C", "link-arg=-fuse-ld=mold"]
[target.'cfg(all(target_os = "linux", target_env = "gnu"))']
rustflags = ["-C", "link-arg=-fuse-ld=lld"]

# macOS - Keep default linker (ld64 is already fast on macOS)
# Note: lld on macOS has compatibility issues, using default linker instead
# [target.'cfg(target_os = "macos")']
# rustflags = ["-C", "link-arg=-fuse-ld=lld"]

# Linux musl - Fully static binary (keep self-contained)
[target.x86_64-unknown-linux-musl]
rustflags = [
    "-C", "target-feature=+crt-static",
    "-C", "link-self-contained=yes",
    "-C", "link-arg=-fuse-ld=lld",
]

[target.aarch64-unknown-linux-musl]
rustflags = [
    "-C", "target-feature=+crt-static",
    "-C", "link-self-contained=yes",
    "-C", "link-arg=-fuse-ld=lld",
]

# ============================================
# Optional: Nightly-only optimizations
# ============================================
# Uncomment the following sections if using nightly toolchain
# Run: rustup toolchain install nightly
# Then: cargo +nightly build

# [target.'cfg(all(target_os = "linux", target_env = "gnu"))']
# rustflags = [
#     "-C", "link-arg=-fuse-ld=lld",
#     # Share generic code across crates (reduces compile time)
#     "-Zshare-generics=y",
#     # Use all CPU cores for frontend compilation
#     "-Zthreads=0",
# ]

# [target.'cfg(target_os = "macos")']
# rustflags = [
#     # Share generic code across crates
#     "-Zshare-generics=y",
#     # Use all CPU cores for frontend compilation
#     "-Zthreads=0",
# ]

# [target.'cfg(all(target_env = "msvc", target_os = "windows"))']
# rustflags = [
#     "-C", "target-feature=+crt-static",
#     "-C", "link-arg=-fuse-ld=lld",
#     # Use all CPU cores for frontend compilation
#     "-Zthreads=0",
#     # Note: share-generics=y may cause issues on Windows with dynamic linking
#     "-Zshare-generics=n",
# ]

# ============================================
# Optional: Reduce debug info for faster builds
# ============================================
# Uncomment to reduce compile time (trades off debugging experience)
# debug = 1 means line-number tables only (no local variable info)

# [profile.dev]
# debug = 1
