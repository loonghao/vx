# Maintainer: Long Hao <hal.long@outlook.com>
# Contributor: vx contributors

pkgname=vx-bin
pkgver={{VERSION}}
pkgrel=1
pkgdesc="Universal version manager for developer tools - Node.js, Python, Go, Rust and more"
arch=('x86_64' 'aarch64')
url="https://github.com/loonghao/vx"
license=('MIT')
provides=('vx')
conflicts=('vx' 'vx-git')
depends=('gcc-libs')
optdepends=(
    'git: for cloning repositories'
    'curl: for downloading tools'
)

source_x86_64=("${pkgname}-${pkgver}-x86_64.tar.gz::https://github.com/loonghao/vx/releases/download/v${pkgver}/vx-x86_64-unknown-linux-gnu.tar.gz")
source_aarch64=("${pkgname}-${pkgver}-aarch64.tar.gz::https://github.com/loonghao/vx/releases/download/v${pkgver}/vx-aarch64-unknown-linux-gnu.tar.gz")

sha256sums_x86_64=('SKIP')
sha256sums_aarch64=('SKIP')

package() {
    cd "$srcdir"

    # Install binary
    install -Dm755 vx "$pkgdir/usr/bin/vx"

    # Install license
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

    # Install documentation
    install -Dm644 README.md "$pkgdir/usr/share/doc/$pkgname/README.md"

    # Generate and install shell completions
    "$pkgdir/usr/bin/vx" completions bash > vx.bash 2>/dev/null || true
    "$pkgdir/usr/bin/vx" completions zsh > _vx 2>/dev/null || true
    "$pkgdir/usr/bin/vx" completions fish > vx.fish 2>/dev/null || true

    if [ -f vx.bash ]; then
        install -Dm644 vx.bash "$pkgdir/usr/share/bash-completion/completions/vx"
    fi
    if [ -f _vx ]; then
        install -Dm644 _vx "$pkgdir/usr/share/zsh/site-functions/_vx"
    fi
    if [ -f vx.fish ]; then
        install -Dm644 vx.fish "$pkgdir/usr/share/fish/vendor_completions.d/vx.fish"
    fi
}
