# NuGet Package Manager Provider Manifest
#
# NuGet is the package manager for .NET. It provides tools for creating, publishing,
# and consuming .NET packages.
#
# The standalone NuGet CLI (nuget.exe) is available for Windows.
# On other platforms, use `dotnet nuget` commands via .NET SDK.
#
# Usage:
#   vx nuget install <package>
#   vx nuget restore
#   vx nuget push <package>

[provider]
name = "nuget"
description = "NuGet - The package manager for .NET"
homepage = "https://www.nuget.org/"
repository = "https://github.com/NuGet/NuGet.Client"
ecosystem = "dotnet"

# nuget CLI
[[runtimes]]
name = "nuget"
description = "NuGet command-line tool"
executable = "nuget"
aliases = ["nuget-cli"]

[runtimes.versions]
source = "nuget-releases"

# Detection configuration
[runtimes.detection]
command = "{executable} help"
pattern = "NuGet Version: ([\\d.]+)"
system_paths = [
    "C:\\Program Files\\NuGet\\nuget.exe",
    "C:\\Program Files (x86)\\NuGet\\nuget.exe"
]

# RFC 0019: Layout configuration
[runtimes.layout]
download_type = "binary"

[runtimes.layout.binary."windows-x86_64"]
source_name = "nuget.exe"
target_name = "nuget.exe"
target_dir = "."

[runtimes.layout.binary."windows-x86"]
source_name = "nuget.exe"
target_name = "nuget.exe"
target_dir = "."

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# RFC 0021: System installation strategies
[runtimes.system_install]

# Windows: chocolatey installation (preferred for standalone nuget.exe)
[[runtimes.system_install.strategies]]
type = "package_manager"
manager = "choco"
package = "nuget.commandline"
platforms = ["windows"]
priority = 90

# Windows: winget installation
[[runtimes.system_install.strategies]]
type = "package_manager"
manager = "winget"
package = "Microsoft.NuGet"
platforms = ["windows"]
priority = 80

# Direct download from nuget.org
[[runtimes.system_install.strategies]]
type = "direct_download"
url = "https://dist.nuget.org/win-x86-commandline/latest/nuget.exe"
platforms = ["windows"]
priority = 70

# macOS/Linux: Use dotnet nuget instead
# (nuget CLI is Windows-only, .NET SDK provides cross-platform nuget commands)
[[runtimes.system_install.strategies]]
type = "bundled_command"
parent_runtime = "dotnet"
command_prefix = ["dotnet", "nuget"]
platforms = ["macos", "linux"]
priority = 100

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 30000
functional_commands = [
    { command = "{executable} help", expect_success = true, expected_output = "NuGet Version", name = "version_check" },
]

# NuGet dependencies
[[runtimes.constraints]]
when = "*"
recommends = [
    { runtime = "dotnet", version = "*", reason = ".NET SDK is recommended for full NuGet functionality" }
]
