# Rust Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for Rust.

[provider]
name = "rust"
description = "A language empowering everyone to build reliable and efficient software"
homepage = "https://www.rust-lang.org"
repository = "https://github.com/rust-lang/rust"
ecosystem = "rust"

# Rustup - Rust toolchain installer
[[runtimes]]
name = "rustup"
description = "Rust toolchain installer"
executable = "rustup"

[runtimes.versions]
source = "github-releases"
owner = "rust-lang"
repo = "rustup"
strip_v_prefix = true

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "binary"

[runtimes.layout.binary."windows-x86_64"]
source_name = "rustup-init.exe"
target_name = "rustup.exe"
target_dir = "bin"

[runtimes.layout.binary."macos-x86_64"]
source_name = "rustup-init"
target_name = "rustup"
target_dir = "bin"
target_permissions = "755"

[runtimes.layout.binary."macos-aarch64"]
source_name = "rustup-init"
target_name = "rustup"
target_dir = "bin"
target_permissions = "755"

[runtimes.layout.binary."linux-x86_64"]
source_name = "rustup-init"
target_name = "rustup"
target_dir = "bin"
target_permissions = "755"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 60000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "rustup \\d+\\.\\d+\\.\\d+", name = "version_check" },
    { command = "{executable} show", expect_success = true, name = "show_toolchains" },
]
install_verification = [
    { command = "{executable} --version", expect_success = true },
]

# Rustc - Rust compiler (managed by rustup)
[[runtimes]]
name = "rustc"
description = "Rust compiler"
executable = "rustc"
managed_by = "rustup"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "rustup", version = "*", reason = "rustc is managed by rustup" }
]

# Cargo - Rust package manager (managed by rustup)
[[runtimes]]
name = "cargo"
description = "Rust package manager"
executable = "cargo"
managed_by = "rustup"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "rustup", version = "*", reason = "cargo is managed by rustup" }
]
