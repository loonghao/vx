# Rust Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for Rust.
#
# Note: vx manages Rust toolchains directly, replacing the need for rustup.
# Users can install specific Rust versions with: vx install rust@1.75.0

[provider]
name = "rust"
description = "A language empowering everyone to build reliable and efficient software"
homepage = "https://www.rust-lang.org"
repository = "https://github.com/rust-lang/rust"
ecosystem = "rust"

# Rustc - Rust compiler
[[runtimes]]
name = "rustc"
description = "Rust compiler"
executable = "rustc"
aliases = ["rust"]

[runtimes.versions]
source = "github-releases"
owner = "rust-lang"
repo = "rust"
strip_v_prefix = false

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive]
strip_prefix = "rust-{version}-{platform}"
executable_paths = [
    "rustc/bin/rustc.exe",   # Windows
    "rustc/bin/rustc"        # Unix
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 60000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "rustc \\d+\\.\\d+\\.\\d+", name = "version_check" },
]
install_verification = [
    { command = "{executable} --version", expect_success = true },
]

[[runtimes.constraints]]
when = "*"
recommends = []

# Cargo - Rust package manager
[[runtimes]]
name = "cargo"
description = "Rust package manager and build tool"
executable = "cargo"

[runtimes.versions]
source = "github-releases"
owner = "rust-lang"
repo = "rust"
strip_v_prefix = false

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive]
strip_prefix = "rust-{version}-{platform}"
executable_paths = [
    "cargo/bin/cargo.exe",   # Windows
    "cargo/bin/cargo"        # Unix
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 60000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "cargo \\d+\\.\\d+\\.\\d+", name = "version_check" },
]
install_verification = [
    { command = "{executable} --version", expect_success = true },
]

[[runtimes.constraints]]
when = "*"
recommends = []
