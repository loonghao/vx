# Go Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for Go.

[provider]
name = "go"
description = "The Go programming language"
homepage = "https://go.dev"
repository = "https://github.com/golang/go"
ecosystem = "go"

[[runtimes]]
name = "go"
description = "Go programming language runtime"
executable = "go"
aliases = ["golang"]

[runtimes.versions]
source = "go-dev"
stable_pattern = "stable"

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} version"
pattern = "go version go([\\d.]+)"
system_paths = ["/usr/local/go/bin/go", "/usr/bin/go", "C:\\Program Files\\Go\\bin\\go.exe"]

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 30000
functional_commands = [
    { command = "{executable} version", expect_success = true, expected_output = "go version go\\d+\\.\\d+", name = "version_check" },
    { command = "{executable} env GOVERSION", expect_success = true, expected_output = "go\\d+\\.\\d+", name = "env_check" },
]
install_verification = [
    { command = "{executable} version", expect_success = true },
]

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive]
strip_prefix = "go"
executable_paths = [
    "bin/go.exe",  # Windows
    "bin/go"       # Unix
]

[runtimes.executable_config]
dir_pattern = "go{version}"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# Go 1.21+ has improved module support
[[runtimes.constraints]]
when = ">=1.21"
recommends = [
    { runtime = "git", version = "*", reason = "Git is required for fetching Go modules" }
]

# Go 1.18-1.20 introduced generics
[[runtimes.constraints]]
when = ">=1.18, <1.21"
recommends = [
    { runtime = "git", version = "*", reason = "Git is required for fetching Go modules" }
]

# gofmt is bundled with Go
[[runtimes]]
name = "gofmt"
description = "Go source code formatter"
executable = "gofmt"
bundled_with = "go"
auto_installable = false

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} -version"
pattern = "v([\\d.]+)"
system_paths = ["/usr/local/go/bin/gofmt", "/usr/bin/gofmt", "C:\\Program Files\\Go\\bin\\gofmt.exe"]

[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "go", version = "*", reason = "gofmt is bundled with go" }
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []
