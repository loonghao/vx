# pnpm Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for pnpm.
# RFC 0017/0018 compliant - includes extended schema fields

[provider]
name = "pnpm"
description = "Fast, disk space efficient package manager"
homepage = "https://pnpm.io"
repository = "https://github.com/pnpm/pnpm"
ecosystem = "nodejs"

[[runtimes]]
name = "pnpm"
description = "pnpm package manager"
executable = "pnpm"
aliases = ["pnpx"]
priority = 85
auto_installable = true
# RFC 0018: Mirror configuration
mirrors = [
    { name = "taobao", region = "cn", url = "https://npmmirror.com/mirrors/pnpm", priority = 100 }
]

[runtimes.versions]
source = "github-releases"
owner = "pnpm"
repo = "pnpm"
strip_v_prefix = true

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} --version"
pattern = "(\\d+\\.\\d+\\.\\d+)"
env_hints = ["PNPM_HOME"]

# RFC 0018: Health check configuration
[runtimes.health]
check_command = "{executable} --version"
expected_pattern = "\\d+\\.\\d+\\.\\d+"
exit_code = 0
timeout_ms = 5000
check_on = ["install"]

# RFC 0018: Cache configuration
[runtimes.cache]
versions_ttl = 3600
cache_downloads = true
downloads_retention_days = 30

[runtimes.platforms.windows]
executable_extensions = [".cmd", ".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# pnpm 7.x requires Node.js 14+
[[runtimes.constraints]]
when = "^7"
requires = [
    { runtime = "node", version = ">=14", recommended = "18", reason = "pnpm 7.x requires Node.js 14+" }
]

# pnpm 8.x requires Node.js 16+
[[runtimes.constraints]]
when = "^8"
requires = [
    { runtime = "node", version = ">=16", recommended = "20", reason = "pnpm 8.x requires Node.js 16+" }
]

# pnpm 9.x requires Node.js 18+
[[runtimes.constraints]]
when = ">=9"
requires = [
    { runtime = "node", version = ">=18", recommended = "22", reason = "pnpm 9.x requires Node.js 18+" }
]
