# Windows Package Manager (winget) Provider Manifest
#
# winget is the official package manager for Windows, built-in on Windows 11
# and available on Windows 10 via App Installer from Microsoft Store.
#
# Installation:
# - Windows 11: Pre-installed
# - Windows 10: Install "App Installer" from Microsoft Store or GitHub releases
#
# Usage:
#   vx winget install <package>
#   vx winget search <query>
#   vx winget upgrade --all

[provider]
name = "winget"
description = "Windows Package Manager - Official package manager for Windows"
homepage = "https://learn.microsoft.com/windows/package-manager/"
repository = "https://github.com/microsoft/winget-cli"
ecosystem = "system"
license = "MIT"

# winget is Windows-only
[provider.platforms]
os = ["windows"]

# winget CLI
[[runtimes]]
name = "winget"
description = "Windows Package Manager command-line tool"
executable = "winget"
aliases = ["winget-cli"]

[runtimes.versions]
source = "github-releases"
owner = "microsoft"
repo = "winget-cli"
strip_v_prefix = true

# Detection configuration
[runtimes.detection]
command = "{executable} --version"
pattern = "v([\\d.]+)"
system_paths = [
    "C:\\Program Files\\WindowsApps\\Microsoft.DesktopAppInstaller_*\\winget.exe",
    "C:\\Users\\*\\AppData\\Local\\Microsoft\\WindowsApps\\winget.exe"
]

# winget is typically pre-installed or installed via Microsoft Store
# Manual installation available via GitHub releases (msixbundle)
[runtimes.script_install]
# Install via PowerShell Add-AppxPackage
install_command = '''
$progressPreference = 'silentlyContinue'
$latestWingetMsixBundleUri = $(Invoke-RestMethod https://api.github.com/repos/microsoft/winget-cli/releases/latest).assets.browser_download_url | Where-Object {$_.EndsWith(".msixbundle")}
$latestWingetMsixBundle = $latestWingetMsixBundleUri.Split("/")[-1]
Invoke-WebRequest -Uri $latestWingetMsixBundleUri -OutFile "./$latestWingetMsixBundle"
Add-AppxPackage -Path "./$latestWingetMsixBundle"
'''

[runtimes.platforms.windows]
executable_extensions = [".exe"]

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 30000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "v\\d+\\.\\d+", name = "version_check" },
]

# winget has no external dependencies
[[runtimes.constraints]]
when = "*"
recommends = []
