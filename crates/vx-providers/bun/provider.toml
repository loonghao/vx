# Bun Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for Bun.

[provider]
name = "bun"
description = "Incredibly fast JavaScript runtime, bundler, test runner, and package manager"
homepage = "https://bun.sh"
repository = "https://github.com/oven-sh/bun"
ecosystem = "nodejs"

# Bun runtime
[[runtimes]]
name = "bun"
description = "Bun JavaScript runtime"
executable = "bun"

[runtimes.versions]
source = "github-releases"
owner = "oven-sh"
repo = "bun"
strip_v_prefix = true

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive]
strip_prefix = "bun-{os}-{arch}"
executable_paths = [
    "bun.exe",  # Windows
    "bun"       # Unix
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# RFC 0018: Environment configuration
# Bun runs package postinstall scripts which may spawn shell processes
[runtimes.env.advanced]
path_prepend = ["{install_dir}"]
inherit_system_vars = ["HOME", "USER", "SHELL", "TERM", "LANG", "LC_*", "TZ", "TMPDIR", "TEMP", "TMP"]

[runtimes.test]
timeout_ms = 30000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "\\d+\\.\\d+\\.\\d+", name = "version_check" },
]

# Bun is self-contained, no external dependencies required
[[runtimes.constraints]]
when = "*"
recommends = [
    { runtime = "node", version = "*", reason = "Some npm packages may require Node.js for native modules" }
]

# bunx - Bun package runner (bundled with Bun)
# RFC 0026: No need for constraints.requires - automatically inferred from bundled_with
[[runtimes]]
name = "bunx"
description = "Bun package runner"
executable = "bun"  # Uses bun executable
bundled_with = "bun"
command_prefix = ["x"]  # bunx args -> bun x args

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []
