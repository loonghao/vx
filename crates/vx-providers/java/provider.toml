# Java Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for Java.

[provider]
name = "java"
description = "Java Development Kit"
homepage = "https://adoptium.net"
repository = "https://github.com/adoptium/temurin-build"
ecosystem = "java"

# Java runtime
[[runtimes]]
name = "java"
description = "Java runtime"
executable = "java"

[runtimes.versions]
source = "adoptium"
lts_pattern = "21"

# RFC 0018: Environment configuration
# Java tools (Maven, Gradle, etc.) often depend on JAVA_HOME
[runtimes.env]
vars = { JAVA_HOME = "{install_dir}" }

[runtimes.env.advanced]
path_prepend = ["{install_dir}/bin"]
# Inherit system vars for shell scripts that Java tools may spawn
inherit_system_vars = ["HOME", "USER", "SHELL", "TERM", "LANG", "LC_*", "TZ", "TMPDIR", "TEMP", "TMP"]

# RFC 0019: Java JDK has complex structure
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive]
strip_prefix = "jdk-{version}+{build}"
executable_paths = [
    "bin/java.exe",  # Windows
    "bin/java"       # Unix
]

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} -version"
pattern = "version \"([\\d.]+)\""
system_paths = ["/usr/bin/java", "/usr/local/bin/java", "C:\\Program Files\\Java\\*\\bin\\java.exe"]
env_hints = ["JAVA_HOME"]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# Java has no external dependencies
[[runtimes.constraints]]
when = "*"
recommends = []

# javac is bundled with JDK
[[runtimes]]
name = "javac"
description = "Java compiler"
executable = "javac"
bundled_with = "java"
auto_installable = false

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} -version"
pattern = "javac ([\\d.]+)"
system_paths = ["/usr/bin/javac", "/usr/local/bin/javac", "C:\\Program Files\\Java\\*\\bin\\javac.exe"]
env_hints = ["JAVA_HOME"]

[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "java", version = "*", reason = "javac is bundled with JDK" }
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []

# jar is bundled with JDK
[[runtimes]]
name = "jar"
description = "Java archive tool"
executable = "jar"
bundled_with = "java"
auto_installable = false

# RFC 0018: Detection configuration
[runtimes.detection]
command = "{executable} --version"
pattern = "jar ([\\d.]+)"
system_paths = ["/usr/bin/jar", "/usr/local/bin/jar", "C:\\Program Files\\Java\\*\\bin\\jar.exe"]
env_hints = ["JAVA_HOME"]

[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "java", version = "*", reason = "jar is bundled with JDK" }
]

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []
