# GNU Make Provider Manifest
# This file defines the metadata, runtimes, and dependency constraints for GNU Make.
#
# NOTE: This provider only supports Windows binary downloads.
# On macOS/Linux, use your system package manager:
#   - macOS: brew install make
#   - Ubuntu/Debian: apt install make
#   - Fedora/RHEL: dnf install make
#
# Consider using 'just' as a modern alternative: vx install just

[provider]
name = "make"
description = "GNU Make - A build automation tool (Windows only, use 'just' as alternative)"
homepage = "https://www.gnu.org/software/make/"
repository = "https://github.com/mbuilov/gnumake-windows"
ecosystem = "system"

# Platform constraint: only Windows is supported for binary download
[provider.platforms]
os = ["windows"]


# Make
[[runtimes]]
name = "make"
aliases = ["gmake", "gnumake"]
description = "GNU Make build automation tool"
executable = "make"

[runtimes.versions]
source = "github-releases"
owner = "mbuilov"
repo = "gnumake-windows"
strip_v_prefix = false

# RFC 0019: Executable Layout Configuration
[runtimes.layout]
download_type = "archive"

[runtimes.layout.archive."windows-x64"]
strip_prefix = ""
executable_path = "make.exe"

[runtimes.layout.archive."windows-x86"]
strip_prefix = ""
executable_path = "make.exe"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

# RFC 0020: Test configuration
[runtimes.test]
timeout_ms = 30000
functional_commands = [
    { command = "{executable} --version", expect_success = true, expected_output = "GNU Make", name = "version_check" },
]
install_verification = [
    { command = "{executable} --version", expect_success = true },
]

# Make has no external dependencies
[[runtimes.constraints]]
when = "*"
recommends = []
