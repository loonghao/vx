# release-plz configuration
# https://release-plz.ieni.dev/docs/config

[workspace]
# Enable changelog generation
changelog_update = true
# Enable git tag creation
git_tag_enable = true
# Git tag name template
git_tag_name = "v{{version}}"
# Enable GitHub release creation
git_release_enable = true
# Release name template
git_release_name = "v{{version}}"
# Enable release draft mode for review
git_release_draft = false

# Changelog configuration using git-cliff
[changelog]
header = """
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""

body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits %}
        - {% if commit.scope %}**{{commit.scope}}**: {% endif %}{{ commit.message | upper_first }}\
    {% endfor %}
{% endfor %}\n
"""

trim = true

[changelog.git]
conventional_commits = true
filter_unconventional = true
split_commits = false
commit_preprocessors = [
    { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](https://github.com/loonghao/vx/issues/${2}))"},
]
commit_parsers = [
    { message = "^feat", group = "<!-- 0 -->ğŸš€ Features"},
    { message = "^fix", group = "<!-- 1 -->ğŸ› Bug Fixes"},
    { message = "^doc", group = "<!-- 3 -->ğŸ“š Documentation"},
    { message = "^perf", group = "<!-- 4 -->âš¡ Performance"},
    { message = "^refactor", group = "<!-- 2 -->ğŸšœ Refactor"},
    { message = "^style", group = "<!-- 5 -->ğŸ¨ Styling"},
    { message = "^test", group = "<!-- 6 -->ğŸ§ª Testing"},
    { message = "^chore\\(release\\): prepare for", skip = true},
    { message = "^chore\\(deps.*\\)", skip = true},
    { message = "^chore\\(pr\\)", skip = true},
    { message = "^chore\\(pull\\)", skip = true},
    { message = "^chore|^ci", group = "<!-- 7 -->âš™ï¸ Miscellaneous Tasks"},
    { body = ".*security", group = "<!-- 8 -->ğŸ›¡ï¸ Security"},
    { message = "^revert", group = "<!-- 9 -->â—€ï¸ Revert"},
]
protect_breaking_commits = false
filter_commits = false
tag_pattern = "v[0-9].*"
skip_tags = "v0.1.0-beta.1"
ignore_tags = ""
topo_order = false
sort_commits = "oldest"

# Package-specific configuration
[[package]]
name = "vx"
# Enable changelog for the main package
changelog_update = true
# Custom release body template
git_release_body = """
## What's Changed

{{ changelog }}

**Full Changelog**: https://github.com/loonghao/vx/compare/{{ previous_tag }}...{{ tag }}

## Installation

### Download Binary
Download the appropriate binary for your platform from the assets below.

### Package Managers
- **Windows (WinGet)**: `winget install loonghao.vx`
- **Windows (Chocolatey)**: `choco install vx`
- **macOS (Homebrew)**: `brew install loonghao/vx/vx`
- **Windows (Scoop)**: `scoop bucket add vx https://github.com/loonghao/scoop-vx && scoop install vx`

### Cargo
```bash
cargo install vx
```
"""
