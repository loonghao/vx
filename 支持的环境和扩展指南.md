# vx æ”¯æŒçš„ç¯å¢ƒå’Œæ‰©å±•æŒ‡å—

## ğŸ“‹ ç›®å‰æ”¯æŒçš„ç¯å¢ƒ/å·¥å…·

vx ç›®å‰æ”¯æŒ **40+ ç§å¼€å‘å·¥å…·**ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

### è¯­è¨€è¿è¡Œæ—¶ï¼ˆLanguage Runtimesï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **Node.js** | `node`, `npm`, `npx` | JavaScript è¿è¡Œæ—¶å’ŒåŒ…ç®¡ç†å™¨ |
| **Bun** | `bun`, `bunx` | å¿«é€Ÿå…¨èƒ½ JavaScript è¿è¡Œæ—¶ |
| **Deno** | `deno` | å®‰å…¨çš„ JavaScript/TypeScript è¿è¡Œæ—¶ |
| **Go** | `go` | Go ç¼–ç¨‹è¯­è¨€ |
| **Rust** | `cargo`, `rustc`, `rustup` | Rust å·¥å…·é“¾ |
| **Java** | `java`, `javac` | Java å¼€å‘å·¥å…·åŒ… |
| **Zig** | `zig` | Zig ç¼–ç¨‹è¯­è¨€ |
| **Python** | `python` | Python è¿è¡Œæ—¶ï¼ˆé€šè¿‡ UVï¼‰ |

### åŒ…ç®¡ç†å™¨ï¼ˆPackage Managersï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **UV** | `uv`, `uvx` | å¿«é€Ÿ Python åŒ…ç®¡ç†å™¨ |
| **pnpm** | `pnpm`, `pnpx` | å¿«é€Ÿã€ç£ç›˜é«˜æ•ˆçš„åŒ…ç®¡ç†å™¨ |
| **Yarn** | `yarn` | JavaScript åŒ…ç®¡ç†å™¨ |

### æ„å»ºå·¥å…·ï¼ˆBuild Toolsï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **Vite** | `vite` | ä¸‹ä¸€ä»£å‰ç«¯å·¥å…· |
| **Just** | `just` | é¡¹ç›®ä»»åŠ¡å‘½ä»¤è¿è¡Œå™¨ |
| **Task** | `task` | ä»»åŠ¡è¿è¡Œå™¨ / æ„å»ºå·¥å…· (go-task) |
| **CMake** | `cmake` | è·¨å¹³å°æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ |
| **Ninja** | `ninja` | ä¸“æ³¨äºé€Ÿåº¦çš„å°å‹æ„å»ºç³»ç»Ÿ |
| **protoc** | `protoc` | Protocol Buffers ç¼–è¯‘å™¨ |
| **NASM** | `nasm` | Netwide Assembler |
| **YASM** | `yasm` | YASM Assembler |

### DevOps å·¥å…·ï¼ˆDevOps Toolsï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **Docker** | `docker` | å®¹å™¨è¿è¡Œæ—¶å’Œå·¥å…· |
| **Terraform** | `terraform` | åŸºç¡€è®¾æ–½å³ä»£ç  |
| **kubectl** | `kubectl` | Kubernetes å‘½ä»¤è¡Œå·¥å…· |
| **Helm** | `helm` | Kubernetes åŒ…ç®¡ç†å™¨ |
| **Git** | `git` | ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ |

### äº‘ CLI å·¥å…·ï¼ˆCloud CLI Toolsï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **AWS CLI** | `aws` | äºšé©¬é€Šäº‘æœåŠ¡ CLI |
| **Azure CLI** | `az` | å¾®è½¯ Azure CLI |
| **gcloud** | `gcloud` | è°·æ­Œäº‘å¹³å° CLI |

### ä»£ç è´¨é‡å·¥å…·ï¼ˆCode Quality Toolsï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **pre-commit** | `pre-commit` | é¢„æäº¤é’©å­æ¡†æ¶ |

### å…¶ä»–å·¥å…·ï¼ˆOther Toolsï¼‰

| å·¥å…· | å‘½ä»¤ | æè¿° |
|------|------|------|
| **VS Code** | `code` | Visual Studio Code ç¼–è¾‘å™¨ |
| **Rez** | `rez` | åŒ…ç®¡ç†ç³»ç»Ÿ |
| **rcedit** | `rcedit` | Windows èµ„æºç¼–è¾‘å™¨ |
| **Ollama** | `ollama` | AI æ¨¡å‹è¿è¡Œå·¥å…· |
| **Spack** | `spack` | HPC åŒ…ç®¡ç†å™¨ |
| **Release Please** | `release-please` | è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…· |
| **MSVC** | `cl` | Microsoft Visual C++ ç¼–è¯‘å™¨ |

### ä»…æ¸…å•æ–‡ä»¶ï¼ˆManifest Onlyï¼‰

ä»¥ä¸‹å·¥å…·åªæœ‰ `provider.toml` æ¸…å•æ–‡ä»¶ï¼Œå°šæœªå®ç°å®Œæ•´ Providerï¼š

- `curl` - å‘½ä»¤è¡Œå·¥å…·
- `openssl` - åŠ å¯†åº“
- `systemctl` - ç³»ç»ŸæœåŠ¡ç®¡ç†
- `msbuild` - Microsoft æ„å»ºå·¥å…·
- `xcodebuild` - Xcode æ„å»ºå·¥å…·

## ğŸš€ å¦‚ä½•æ‰©å±•æ–°æ¡†æ¶æ”¯æŒ

vx æä¾›äº†ä¸¤ç§æ‰©å±•æ–¹å¼ï¼š

### æ–¹å¼ 1ï¼šåˆ›å»º Providerï¼ˆæ¨èç”¨äºæ ¸å¿ƒå·¥å…·ï¼‰

Provider æ˜¯ Rust å®ç°çš„ï¼Œæä¾›å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†ã€å®‰è£…å’Œæ‰§è¡ŒåŠŸèƒ½ã€‚

#### æ­¥éª¤ 1ï¼šåˆ›å»º Provider ç›®å½•ç»“æ„

```bash
cd crates/vx-providers
mkdir -p mytool/src
cd mytool
```

#### æ­¥éª¤ 2ï¼šåˆ›å»º Cargo.toml

```toml
[package]
name = "vx-provider-mytool"
version.workspace = true
edition.workspace = true
license.workspace = true
description = "vx provider for MyTool"

[dependencies]
vx-core = { workspace = true }
vx-runtime = { workspace = true }
async-trait = { workspace = true }
anyhow = { workspace = true }
serde = { workspace = true, features = ["derive"] }
serde_json = { workspace = true }
tracing = { workspace = true }
```

#### æ­¥éª¤ 3ï¼šå®ç° Runtime Trait

åˆ›å»º `src/runtime.rs`ï¼š

```rust
use async_trait::async_trait;
use vx_runtime::{
    Runtime, RuntimeContext, VersionInfo, Ecosystem, Platform,
};
use anyhow::Result;
use std::collections::HashMap;

pub struct MyToolRuntime;

impl MyToolRuntime {
    pub fn new() -> Self {
        Self
    }
}

#[async_trait]
impl Runtime for MyToolRuntime {
    // ========== å¿…éœ€æ–¹æ³• ==========
    
    /// è¿è¡Œæ—¶åç§° - ç”¨ä½œå‘½ä»¤å
    fn name(&self) -> &str {
        "mytool"
    }

    /// ä»å®˜æ–¹æºè·å–å¯ç”¨ç‰ˆæœ¬
    async fn fetch_versions(&self, ctx: &RuntimeContext) -> Result<Vec<VersionInfo>> {
        // ç¤ºä¾‹ï¼šä» GitHub Releases API è·å–
        let url = "https://api.github.com/repos/org/mytool/releases";
        let response: serde_json::Value = ctx.http.get_json_value(url).await?;

        let versions = response
            .as_array()
            .unwrap_or(&vec![])
            .iter()
            .filter_map(|release| {
                let tag = release["tag_name"].as_str()?;
                let version = tag.strip_prefix('v').unwrap_or(tag);
                let prerelease = release["prerelease"].as_bool().unwrap_or(false);

                Some(VersionInfo {
                    version: version.to_string(),
                    prerelease,
                    lts: false,
                    released_at: release["published_at"].as_str().map(String::from),
                    download_url: None,
                    checksum: None,
                    metadata: HashMap::new(),
                })
            })
            .collect();

        Ok(versions)
    }

    // ========== å¯é€‰æ–¹æ³• ==========

    fn description(&self) -> &str {
        "MyTool - ä¸€ä¸ªä¼˜ç§€çš„å¼€å‘å·¥å…·"
    }

    fn aliases(&self) -> &[&str] {
        &["mt", "my-tool"]  // åˆ«å
    }

    fn ecosystem(&self) -> Ecosystem {
        Ecosystem::Unknown  // æˆ– NodeJs, Go, Rust, Python ç­‰
    }

    /// è·å–ç‰¹å®šç‰ˆæœ¬å’Œå¹³å°çš„ä¸‹è½½ URL
    async fn download_url(&self, version: &str, platform: &Platform) -> Result<Option<String>> {
        let os = match platform.os.as_str() {
            "macos" => "darwin",
            "windows" => "windows",
            "linux" => "linux",
            _ => return Ok(None),
        };

        let arch = match platform.arch.as_str() {
            "x86_64" => "amd64",
            "aarch64" => "arm64",
            _ => return Ok(None),
        };

        let ext = if platform.os == "windows" { "zip" } else { "tar.gz" };

        Ok(Some(format!(
            "https://github.com/org/mytool/releases/download/v{}/mytool-{}-{}.{}",
            version, os, arch, ext
        )))
    }

    /// è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶åœ¨è§£å‹åŒ…ä¸­çš„ç›¸å¯¹è·¯å¾„
    fn executable_relative_path(&self, _version: &str, platform: &Platform) -> String {
        if platform.os == "windows" {
            "mytool.exe".to_string()
        } else {
            "mytool".to_string()
        }
    }
}
```

#### æ­¥éª¤ 4ï¼šå®ç° Provider Trait

åˆ›å»º `src/provider.rs`ï¼š

```rust
use std::sync::Arc;
use vx_runtime::{Provider, Runtime};
use crate::runtime::MyToolRuntime;

pub struct MyToolProvider;

impl Provider for MyToolProvider {
    fn name(&self) -> &str {
        "mytool"
    }

    fn description(&self) -> &str {
        "MyTool å¼€å‘å·¥å…·"
    }

    fn runtimes(&self) -> Vec<Arc<dyn Runtime>> {
        vec![Arc::new(MyToolRuntime::new())]
    }
}

// æä¾›å·¥å‚å‡½æ•°ï¼ˆç”¨äºæ¸…å•é©±åŠ¨æ³¨å†Œï¼‰
pub fn create_provider() -> Box<dyn Provider> {
    Box::new(MyToolProvider)
}
```

#### æ­¥éª¤ 5ï¼šå¯¼å‡ºæ¨¡å—

åˆ›å»º `src/lib.rs`ï¼š

```rust
mod provider;
mod runtime;

pub use provider::{MyToolProvider, create_provider};
pub use runtime::MyToolRuntime;
```

#### æ­¥éª¤ 6ï¼šåˆ›å»º Provider æ¸…å•æ–‡ä»¶

åˆ›å»º `provider.toml`ï¼š

```toml
[provider]
name = "mytool"
description = "MyTool development tool"
homepage = "https://mytool.org"
repository = "https://github.com/org/mytool"
ecosystem = "unknown"

[[runtimes]]
name = "mytool"
description = "MyTool runtime"
executable = "mytool"
aliases = ["mt", "my-tool"]
priority = 100
auto_installable = true

[runtimes.versions]
source = "github-releases"
repo = "org/mytool"

[runtimes.executable_config]
extensions = [".exe"]
dir_pattern = "mytool-{version}-{platform}-{arch}"

[runtimes.platforms.windows]
executable_extensions = [".exe"]

[runtimes.platforms.unix]
executable_extensions = []
```

#### æ­¥éª¤ 7ï¼šæ³¨å†Œ Provider

åœ¨ `Cargo.toml`ï¼ˆæ ¹ç›®å½•ï¼‰ä¸­æ·»åŠ ï¼š

```toml
[workspace.members]
# ... ç°æœ‰æˆå‘˜
"crates/vx-providers/mytool",
```

åœ¨ `crates/vx-cli/src/registry.rs` ä¸­æ³¨å†Œï¼š

```rust
// åœ¨ register_provider_factories! å®ä¸­æ·»åŠ 
register_provider_factories!(
    $registry,
    // ... ç°æœ‰ providers
    mytool,
);
```

åœ¨ `crates/vx-cli/Cargo.toml` ä¸­æ·»åŠ ä¾èµ–ï¼š

```toml
[dependencies]
# ... ç°æœ‰ä¾èµ–
vx-provider-mytool = { path = "../vx-providers/mytool" }
```

#### æ­¥éª¤ 8ï¼šæ›´æ–° build.rs

Provider æ¸…å•æ–‡ä»¶ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨åµŒå…¥ï¼Œç¡®ä¿ `build.rs` åŒ…å«ä½ çš„ providerã€‚

### æ–¹å¼ 2ï¼šåˆ›å»º Extensionï¼ˆæ¨èç”¨äºè„šæœ¬å·¥å…·ï¼‰

Extension ä½¿ç”¨è„šæœ¬è¯­è¨€ï¼ˆPythonã€Node.jsã€Shellï¼‰å®ç°ï¼Œæ›´é€‚åˆå¿«é€ŸåŸå‹å’Œè„šæœ¬å·¥å…·ã€‚

#### æ­¥éª¤ 1ï¼šåˆ›å»º Extension ç›®å½•

```bash
mkdir -p ~/.vx/extensions/my-extension
cd ~/.vx/extensions/my-extension
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»º `vx-extension.toml`ï¼š

```toml
[extension]
name = "my-extension"
version = "1.0.0"
description = "My custom extension"
type = "command"

[runtime]
requires = "python >= 3.8"

[entrypoint]
main = "main.py"

[commands.hello]
description = "Say hello"
script = "main.py"
args = ["hello"]

[commands.greet]
description = "Greet someone"
script = "main.py"
args = ["greet"]
```

#### æ­¥éª¤ 3ï¼šåˆ›å»ºè„šæœ¬

åˆ›å»º `main.py`ï¼š

```python
#!/usr/bin/env python3
import sys
import os

def main():
    args = sys.argv[1:]

    if not args:
        print("Usage: vx x my-extension <hello|greet> [args...]")
        sys.exit(1)

    cmd = args[0]

    if cmd == "hello":
        print("Hello from my extension!")
    elif cmd == "greet":
        name = args[1] if len(args) > 1 else "World"
        print(f"Hello, {name}!")
    else:
        print(f"Unknown command: {cmd}")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

#### æ­¥éª¤ 4ï¼šä½¿ç”¨ Extension

```bash
# åˆ—å‡ºæ‰©å±•
vx ext list

# è¿è¡Œå‘½ä»¤
vx x my-extension hello
vx x my-extension greet Alice
```

## ğŸ“ Provider vs Extension å¯¹æ¯”

| ç‰¹æ€§ | Provider | Extension |
|------|----------|-----------|
| **å®ç°è¯­è¨€** | Rust | Python/Node.js/Shell |
| **æ€§èƒ½** | é«˜æ€§èƒ½ | ä¸­ç­‰ |
| **åŠŸèƒ½** | å®Œæ•´ï¼ˆç‰ˆæœ¬ç®¡ç†ã€å®‰è£…ã€æ‰§è¡Œï¼‰ | è„šæœ¬æ‰§è¡Œ |
| **é€‚ç”¨åœºæ™¯** | æ ¸å¿ƒå¼€å‘å·¥å…· | è¾…åŠ©è„šæœ¬ã€å·¥å…·é“¾ |
| **å¼€å‘éš¾åº¦** | è¾ƒé«˜ | è¾ƒä½ |
| **é›†æˆæ–¹å¼** | ç¼–è¯‘åˆ°äºŒè¿›åˆ¶ | è¿è¡Œæ—¶åŠ è½½ |

## ğŸ”§ é«˜çº§åŠŸèƒ½

### ç”Ÿå‘½å‘¨æœŸé’©å­

Provider å¯ä»¥è‡ªå®šä¹‰å®‰è£…å’Œæ‰§è¡Œæµç¨‹ï¼š

```rust
#[async_trait]
impl Runtime for MyToolRuntime {
    /// å®‰è£…å‰è°ƒç”¨ - éªŒè¯ç¯å¢ƒ
    async fn pre_install(&self, version: &str, ctx: &RuntimeContext) -> Result<()> {
        // æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
        Ok(())
    }

    /// è§£å‹åè°ƒç”¨ - é‡å‘½åæ–‡ä»¶ã€è®¾ç½®æƒé™
    fn post_extract(&self, version: &str, install_path: &PathBuf) -> Result<()> {
        #[cfg(unix)]
        {
            use std::os::unix::fs::PermissionsExt;
            let exe = install_path.join("mytool");
            if exe.exists() {
                let mut perms = std::fs::metadata(&exe)?.permissions();
                perms.set_mode(0o755);
                std::fs::set_permissions(&exe, perms)?;
            }
        }
        Ok(())
    }

    /// æ‰§è¡Œå‰è°ƒç”¨
    async fn pre_run(&self, args: &[String], executable: &Path) -> Result<bool> {
        // è®¾ç½®ç¯å¢ƒå˜é‡ã€éªŒè¯å‚æ•°ç­‰
        Ok(true)
    }
}
```

### ä¾èµ–å…³ç³»ç®¡ç†

åœ¨ `provider.toml` ä¸­å®šä¹‰ä¾èµ–ï¼š

```toml
[[runtimes.constraints]]
when = "*"
requires = [
    { runtime = "node", version = ">=18", reason = "éœ€è¦ Node.js 18+" }
]
```

### å¹³å°ç‰¹å®šé…ç½®

```toml
[runtimes.platforms.windows]
executable_extensions = [".exe"]
download_url_pattern = "https://example.com/windows/{version}/mytool.exe"

[runtimes.platforms.macos]
executable_extensions = []
download_url_pattern = "https://example.com/macos/{version}/mytool"
```

## ğŸ“š å‚è€ƒèµ„æº

- **Provider å¼€å‘æ–‡æ¡£**ï¼š`docs/advanced/plugin-development.md`
- **Extension å¼€å‘æ–‡æ¡£**ï¼š`docs/advanced/extension-development.md`
- **ç¤ºä¾‹ Provider**ï¼š
  - `crates/vx-providers/go/` - Go Provider ç¤ºä¾‹
  - `crates/vx-providers/node/` - Node.js Provider ç¤ºä¾‹
- **ç¤ºä¾‹ Extension**ï¼š`examples/extensions/`

## ğŸ¯ æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„æ‰©å±•æ–¹å¼**ï¼š
   - æ ¸å¿ƒå·¥å…· â†’ Provider
   - è„šæœ¬å·¥å…· â†’ Extension

2. **éµå¾ªå‘½åè§„èŒƒ**ï¼š
   - Provider crate: `vx-provider-<name>`
   - Extension: `<name>`

3. **å®ç°é”™è¯¯å¤„ç†**ï¼š
   - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
   - å¤„ç†ç½‘ç»œé”™è¯¯ã€æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ç­‰

4. **æ·»åŠ æµ‹è¯•**ï¼š
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•

5. **æ–‡æ¡£åŒ–**ï¼š
   - åœ¨ README ä¸­è¯´æ˜ä½¿ç”¨æ–¹æ³•
   - æ·»åŠ ä»£ç æ³¨é‡Š

## ğŸ’¡ ç¤ºä¾‹ï¼šæ·»åŠ  Swift æ”¯æŒ

å‡è®¾è¦æ·»åŠ  Swift æ”¯æŒï¼š

1. **åˆ›å»º Provider**ï¼š
   ```bash
   mkdir -p crates/vx-providers/swift
   ```

2. **å®ç° Runtime**ï¼š
   - ä» Apple å®˜æ–¹æºè·å–ç‰ˆæœ¬
   - å¤„ç† macOS ç‰¹å®šçš„å®‰è£…æµç¨‹
   - æ”¯æŒ `swift` å’Œ `swiftc` å‘½ä»¤

3. **æ³¨å†Œ Provider**ï¼š
   - æ·»åŠ åˆ° `registry.rs`
   - æ·»åŠ åˆ° `Cargo.toml`

4. **æµ‹è¯•**ï¼š
   ```bash
   vx swift --version
   vx swiftc --version
   ```

## ğŸ”— ç›¸å…³æ–‡ä»¶ä½ç½®

- Provider å®ç°ï¼š`crates/vx-providers/<name>/`
- Provider æ³¨å†Œï¼š`crates/vx-cli/src/registry.rs`
- Extension ç›®å½•ï¼š`~/.vx/extensions/`
- æ–‡æ¡£ï¼š`docs/advanced/`

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å°±å¯ä»¥ä¸º vx æ·»åŠ æ–°çš„æ¡†æ¶æ”¯æŒäº†ï¼
