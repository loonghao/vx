name: PR Checks

# Lightweight PR validation - delegates to unified CI workflow
# This workflow ensures PR checks show up correctly in GitHub UI

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: write

# Cancel in-progress runs for the same PR
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  # Delegate to unified CI workflow
  ci:
    name: CI
    uses: ./.github/workflows/ci.yml
    secrets: inherit

  # PR-specific summary
  pr-summary:
    name: PR Summary
    runs-on: ubuntu-latest
    needs: ci
    if: always()
    steps:
      - name: Generate PR summary
        run: |
          echo "## PR Check Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          CI_RESULT="${{ needs.ci.result }}"

          if [[ "$CI_RESULT" == "success" ]]; then
            echo "✅ **All checks passed!** This PR is ready for review." >> $GITHUB_STEP_SUMMARY
          elif [[ "$CI_RESULT" == "skipped" ]]; then
            echo "⏭️ **CI was skipped.** No relevant changes detected." >> $GITHUB_STEP_SUMMARY
          else
            echo "❌ **CI failed.** Please check the workflow logs for details." >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
